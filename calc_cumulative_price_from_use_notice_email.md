# PG名
calc_cumulative_price_from_use_notice_email.gs

# 想定用途
クレジットカードのアプリで現在の利用金額を確認するものの、反映が遅いため、家計の管理が難しくなっていました。  
現状、決済の取り消しなどはあまり発生しないので、速報ベースでの把握を実現したくGASでの実装を行いました。

# 前提
クレジットカードを利用すると毎回同じ形式でメールが届く。  
今回はこんなメールが届く想定です。
```
ご利用頂きありがとうございます。�
ご家族会員さまのカードご利用内容をお知らせいたします。�
◇利用日：2025/08/20 10:42
◇利用先：Visa加盟店�
◇利用取引：買物�
◇利用金額：1,351.00JPY
```

# 利用手順
1. SpreadSheetに以下のイメージでheaderを作成する。
    |日時	|店名	| 金額	|金額(数値)|
    |:--|:--|:--|:--|
    |2025/07/28|◇利用先：Visa加盟店|◇利用金額：500.00JPY|	500|
    |2025/08/01|◇利用先：Visa加盟店|◇利用金額：1,341.00JPY|	1,341|
1. SpreadSheetのF1セルに以下の式を追加
    - =SUMPRODUCT((YEAR(A2:A)=YEAR(TODAY())) * (MONTH(A2:A)=MONTH(TODAY())) * (D2:D))
    - 当月の金額だけをSUMするということをやっているだけ
1. Gmailにフィルタを作って、特定メールを自動でラベル付け
    - ラベル作成
        - Gmail左サイドバー最下部「もっと見る」→「新しいラベルを作成」
        - ラベル名は今回は「食費」としました
    - フィルタ作成
        - 右上 ⚙ →「すべての設定を表示」→「フィルタとブロック中のアドレス」→「新しいフィルタを作成」
        - 送信元・件名・本文キーワードなどで条件を指定
        - 「フィルタを作成」→「ラベルを適用する」で 食費 を選択
3. Apps Script（GAS）実装
    - スプレッドシート上で「拡張機能 → Apps Script」→ 保存
    - トリガー設定：Apps Script 画面左「トリガー（時計アイコン）」→「トリガーを追加」

# 備考
GASは実行回数に制限があるため留意が必要です。  
メールのR/W 20,000回/日  
トリガー　20
